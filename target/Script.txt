<tomcat-users>
<role rolename="manager-script"/>
<user username="admin" password="1234" roles="manager-script"/>
</tomcat-users>

FROM tomcat:9.0
RUN rm -rf /usr/local/tomcat/webapps/*
COPY target/*.war /usr/local/tomcat/webapps/ROOT.war
CMD ["catalina.sh","run"]

pipeline{
    agent any
    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/nikhileshnilagiri/maven-java-app'
            }
        }

        stage('Clean') {
            steps {
                bat "mvn clean"
            }
        }

        stage('Install') {
            steps {
                bat "mvn install"
            }
        }

        stage('Test') {
            steps {
                bat "mvn test"
            }
        }
    }
    post{
        success{
            emailext body: 'This is a sample to test through the pipeline', subject: 'Build Success', to: 'nikhileshnilagiri2006@gmail.com'
        }
        failure{
            emailext body: 'This is a sample to test through the pipeline', subject: 'Build failure', to: 'nikhileshnilagiri2006@gmail.com'
        }
    }
}





pipeline{
    agent any
    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/nikhileshnilagiri/maven-web-app'
            }
        }

        stage('Clean') {
            steps {
                bat "mvn clean"
            }
        }

        stage('Install') {
            steps {
                bat "mvn install"
            }
        }

        stage('Test') {
            steps {
                bat "mvn test"
            }
        }
        stage('deployment'){
            steps{
                deploy adapters: [tomcat9(alternativeDeploymentContext: '', credentialsId: '92ea1533-cb15-4f40-a28b-ddcd2418727f', path: '', url: 'http://localhost:8081/')], contextPath: null, war: '**/*.war'
            }
        }
    }
    post{
        success{
            emailext body: 'This is a sample to test through the pipeline', subject: 'Build Success', to: 'nikhileshnilagiri2006@gmail.com'
        }
        failure{
            emailext body: 'This is a sample to test through the pipeline', subject: 'Build failure', to: 'nikhileshnilagiri2006@gmail.com'
        }
    }
}


minikube start --driver=docker
kubectl create deployment mynginx --image=nginx
kubectl set image deployment/myngnix nginx=nginx:latest
kubectl get deployments
kubectl expose deployment mynginx --type=NodePort --port=80 --target-port=80
kubectl scale deployment mynginx --replicas=4
kubectl port-forward svc/mynginx 8081:80
if Error:
minikube tunnel
minikube service mynginx â€“url
kubectl delete deployment mynginx
kubectl delete service mynginx

docker pull jasonrivers/nagios:latest


